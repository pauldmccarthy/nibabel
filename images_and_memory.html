<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Neuroimaging in Python &mdash; NiBabel 2.0.2 documentation</title>
    
    <link rel="stylesheet" href="_static/nibabel.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2.0.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="NiBabel 2.0.2 documentation" href="index.html" />
    <link rel="up" title="NiBabel Manual" href="manual.html" />
    <link rel="next" title="Working with NIfTI images" href="nifti_images.html" />
    <link rel="prev" title="Nibabel images" href="nibabel_images.html" />
  <meta name="keywords" content="nipy, neuroimaging, python, neuroscience">

  </head>
  <body role="document">
<div style="background-color: white; text-align: left; padding-left: 150px; padding-bottom:50px; padding-top:20px; background-image: url(_static/nipy-logo-bg-138x120.png); background-repeat: no-repeat;">
<h1>NiBabel</h1>
<h3 style="margin-top:-5px;color:#2f83c8">Access a cacophony of neuro-imaging file formats</h3>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="nifti_images.html" title="Working with NIfTI images"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="nibabel_images.html" title="Nibabel images"
             accesskey="P">previous</a> |</li>
  <li><a href="http://nipy.org/">Community</a> |&nbsp;</li>
  <li><a href="index.html">NiBabel Home</a> |&nbsp;</li>
  <li><a href="https://mail.python.org/mailman/listinfo/neuroimaging">Mailing list</a> |&nbsp;</li>
  <li><a href="legal.html">License</a> |&nbsp;</li>

          <li class="nav-item nav-item-1"><a href="manual.html" accesskey="U">NiBabel Manual</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Images and memory</a><ul>
<li><a class="reference internal" href="#using-in-memory-to-check-the-state-of-the-cache">Using <code class="docutils literal"><span class="pre">in_memory</span></code> to check the state of the cache</a></li>
<li><a class="reference internal" href="#using-uncache">Using <code class="docutils literal"><span class="pre">uncache</span></code></a></li>
<li><a class="reference internal" href="#saving-memory">Saving memory</a><ul>
<li><a class="reference internal" href="#uncache-the-array">Uncache the array</a></li>
<li><a class="reference internal" href="#use-the-array-proxy-instead-of-get-data">Use the array proxy instead of <code class="docutils literal"><span class="pre">get_data()</span></code></a></li>
<li><a class="reference internal" href="#use-the-caching-keyword-to-get-data">Use the <code class="docutils literal"><span class="pre">caching</span></code> keyword to <code class="docutils literal"><span class="pre">get_data()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#saving-time-and-memory">Saving time and memory</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="nibabel_images.html"
                        title="previous chapter">Nibabel images</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="nifti_images.html"
                        title="next chapter">Working with NIfTI images</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/images_and_memory.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
<p><img src="_static/reggie.png" alt="Reggie -- the one" /></p>

        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="images-and-memory">
<h1>Images and memory<a class="headerlink" href="#images-and-memory" title="Permalink to this headline">Â¶</a></h1>
<p>We saw in <a class="reference internal" href="nibabel_images.html"><em>Nibabel images</em></a> that images loaded from disk are usually
<em>proxy images</em>. Proxy images are images that have a <code class="docutils literal"><span class="pre">dataobj</span></code> property that
is not a numpy array, but an <em>array proxy</em> that can fetch the array data from
disk.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">nibabel.testing</span> <span class="kn">import</span> <span class="n">data_path</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">example_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="s1">&#39;example4d.nii.gz&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">nibabel</span> <span class="kn">as</span> <span class="nn">nib</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">img</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">example_file</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">img</span><span class="o">.</span><span class="n">dataobj</span>
<span class="go">&lt;nibabel.arrayproxy.ArrayProxy object at ...&gt;</span>
</pre></div>
</div>
<p>Nibabel does not load the image array from the proxy when you <code class="docutils literal"><span class="pre">load</span></code> the
image.  It waits until you ask for the array data.  The standard way to ask
for the array data is to call the <code class="docutils literal"><span class="pre">get_data()</span></code> method:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(128, 96, 24, 2)</span>
</pre></div>
</div>
<p>We also saw in <a class="reference internal" href="nibabel_images.html#proxies-caching"><span>Proxies and caching</span></a> that this call to <code class="docutils literal"><span class="pre">get_data()</span></code> will
(by default) load the array data into an internal image cache.  The image
returns the cached copy on the next call to <code class="docutils literal"><span class="pre">get_data()</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data_again</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="ow">is</span> <span class="n">data_again</span>
<span class="go">True</span>
</pre></div>
</div>
<p>This behavior is convenient if you want quick and repeated access to the image
array data.  The down-side is that the image keeps a reference to the image
data array, so the array can&#8217;t be cleared from memory until the image object
gets deleted.  You might prefer to keep loading the array from disk instead of
keeping the cached copy in the image.</p>
<p>This page describes ways of using the image array proxies to save memory and
time.</p>
<div class="section" id="using-in-memory-to-check-the-state-of-the-cache">
<h2>Using <code class="docutils literal"><span class="pre">in_memory</span></code> to check the state of the cache<a class="headerlink" href="#using-in-memory-to-check-the-state-of-the-cache" title="Permalink to this headline">Â¶</a></h2>
<p>You can use the <code class="docutils literal"><span class="pre">in_memory</span></code> property to check if the image has cached the
array.</p>
<p>The <code class="docutils literal"><span class="pre">in_memory</span></code> property is always True for array images, because the image
data is always an array in memory:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">array_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">affine</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">array_img</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">Nifti1Image</span><span class="p">(</span><span class="n">array_data</span><span class="p">,</span> <span class="n">affine</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">array_img</span><span class="o">.</span><span class="n">in_memory</span>
<span class="go">True</span>
</pre></div>
</div>
<p>For a proxy image, the <code class="docutils literal"><span class="pre">in_memory</span></code> property is False when the array is not
in cache, and True when it is in cache:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">img</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">example_file</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">img</span><span class="o">.</span><span class="n">in_memory</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">img</span><span class="o">.</span><span class="n">in_memory</span>
<span class="go">True</span>
</pre></div>
</div>
</div>
<div class="section" id="using-uncache">
<h2>Using <code class="docutils literal"><span class="pre">uncache</span></code><a class="headerlink" href="#using-uncache" title="Permalink to this headline">Â¶</a></h2>
<p>As y&#8217;all know, the proxy image has the array in cache, <code class="docutils literal"><span class="pre">get_data()</span></code> returns
the cached array:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data_again</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_again</span> <span class="ow">is</span> <span class="n">data</span>  <span class="c1"># same array returned from cache</span>
<span class="go">True</span>
</pre></div>
</div>
<p>You can uncache a proxy image with the <code class="docutils literal"><span class="pre">uncache()</span></code> method:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">img</span><span class="o">.</span><span class="n">uncache</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">img</span><span class="o">.</span><span class="n">in_memory</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_once_more</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_once_more</span> <span class="ow">is</span> <span class="n">data</span>  <span class="c1"># a new copy read from disk</span>
<span class="go">False</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">uncache()</span></code> has no effect if the image is an array image, or if the cache is
already empty.</p>
<p>You need to be careful when you modify arrays returned by <code class="docutils literal"><span class="pre">get_data()</span></code> on
proxy images, because <code class="docutils literal"><span class="pre">uncache</span></code> will then change the result you get back
from <code class="docutils literal"><span class="pre">get_data()</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">proxy_img</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">example_file</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">proxy_img</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>  <span class="c1"># array cached and returned</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">99</span>  <span class="c1"># modify returned array</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_again</span> <span class="o">=</span> <span class="n">proxy_img</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>  <span class="c1"># return cached array</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_again</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># cached array modified</span>
<span class="go">99</span>
</pre></div>
</div>
<p>So far the proxy image behaves the same as an array image.  <code class="docutils literal"><span class="pre">uncache()</span></code> has
no effect on an array image, but it does have an effect on the returned array
of a proxy image:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">proxy_img</span><span class="o">.</span><span class="n">uncache</span><span class="p">()</span>  <span class="c1"># cached array discarded from proxy image</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_once_more</span> <span class="o">=</span> <span class="n">proxy_img</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>  <span class="c1"># new copy of array loaded</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_once_more</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># array modifications discarded</span>
<span class="go">0</span>
</pre></div>
</div>
</div>
<div class="section" id="saving-memory">
<h2>Saving memory<a class="headerlink" href="#saving-memory" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="uncache-the-array">
<h3>Uncache the array<a class="headerlink" href="#uncache-the-array" title="Permalink to this headline">Â¶</a></h3>
<p>If you do not want the image to keep the array in its internal cache, you can
use the <code class="docutils literal"><span class="pre">uncache()</span></code> method:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">img</span><span class="o">.</span><span class="n">uncache</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="use-the-array-proxy-instead-of-get-data">
<h3>Use the array proxy instead of <code class="docutils literal"><span class="pre">get_data()</span></code><a class="headerlink" href="#use-the-array-proxy-instead-of-get-data" title="Permalink to this headline">Â¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">dataobj</span></code> property of a proxy image is an array proxy.  We can ask the
proxy to return the array directly by passing <code class="docutils literal"><span class="pre">dataobj</span></code> to the numpy
<code class="docutils literal"><span class="pre">asarray</span></code> function:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">proxy_img</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">example_file</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">proxy_img</span><span class="o">.</span><span class="n">dataobj</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">data_array</span><span class="p">)</span>
<span class="go">&lt;type &#39;numpy.ndarray&#39;&gt;</span>
</pre></div>
</div>
<p>This also works for array images, because <code class="docutils literal"><span class="pre">np.asarray</span></code> returns the array:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">array_img</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">Nifti1Image</span><span class="p">(</span><span class="n">array_data</span><span class="p">,</span> <span class="n">affine</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">array_img</span><span class="o">.</span><span class="n">dataobj</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">data_array</span><span class="p">)</span>
<span class="go">&lt;type &#39;numpy.ndarray&#39;&gt;</span>
</pre></div>
</div>
<p>If you want to avoid caching you can avoid <code class="docutils literal"><span class="pre">get_data()</span></code> and always use
<code class="docutils literal"><span class="pre">np.asarray(img.dataobj)</span></code>.</p>
</div>
<div class="section" id="use-the-caching-keyword-to-get-data">
<h3>Use the <code class="docutils literal"><span class="pre">caching</span></code> keyword to <code class="docutils literal"><span class="pre">get_data()</span></code><a class="headerlink" href="#use-the-caching-keyword-to-get-data" title="Permalink to this headline">Â¶</a></h3>
<p>The default behavior of the <code class="docutils literal"><span class="pre">get_data()</span></code> function is to always fill the
cache, if it is empty.  This corresponds to the default <code class="docutils literal"><span class="pre">'fill'</span></code> value
to the <code class="docutils literal"><span class="pre">caching</span></code> keyword.  So, this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">proxy_img</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">example_file</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">proxy_img</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>  <span class="c1"># default caching=&#39;fill&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">proxy_img</span><span class="o">.</span><span class="n">in_memory</span>
<span class="go">True</span>
</pre></div>
</div>
<p>is the same as this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">proxy_img</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">example_file</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">proxy_img</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">caching</span><span class="o">=</span><span class="s1">&#39;fill&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">proxy_img</span><span class="o">.</span><span class="n">in_memory</span>
<span class="go">True</span>
</pre></div>
</div>
<p>Sometimes you may want to avoid filling the cache, if it is empty. In this
case, you can use <code class="docutils literal"><span class="pre">caching='unchanged'</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">proxy_img</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">example_file</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">proxy_img</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">caching</span><span class="o">=</span><span class="s1">&#39;unchanged&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">proxy_img</span><span class="o">.</span><span class="n">in_memory</span>
<span class="go">False</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">caching='unchanged'</span></code> will leave the cache full if it is already full.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">proxy_img</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">caching</span><span class="o">=</span><span class="s1">&#39;fill&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">proxy_img</span><span class="o">.</span><span class="n">in_memory</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">proxy_img</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">caching</span><span class="o">=</span><span class="s1">&#39;unchanged&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">proxy_img</span><span class="o">.</span><span class="n">in_memory</span>
<span class="go">True</span>
</pre></div>
</div>
<p>See the <a class="reference internal" href="reference/nibabel.spatialimages.html#nibabel.spatialimages.SpatialImage.get_data" title="nibabel.spatialimages.SpatialImage.get_data"><code class="xref py py-meth docutils literal"><span class="pre">get_data()</span> <span class="pre">docstring</span></code></a> for more detail.</p>
</div>
</div>
<div class="section" id="saving-time-and-memory">
<h2>Saving time and memory<a class="headerlink" href="#saving-time-and-memory" title="Permalink to this headline">Â¶</a></h2>
<p>You can use the array proxy to get slices of data from disk in an efficient
way.</p>
<p>The array proxy API allows you to do slicing on the proxy.  In most cases this
will mean that you only load the data from disk that you actually need, often
saving both time and memory.</p>
<p>For example, let us say you only wanted the second volume from the example
dataset.  You could do this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">proxy_img</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">example_file</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">proxy_img</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(128, 96, 24, 2)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vol1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vol1</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(128, 96, 24)</span>
</pre></div>
</div>
<p>The problem is that you had to load the whole data array into memory before
throwing away the first volume and keeping the second.</p>
<p>You can use array proxy slicing to do this more efficiently:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">proxy_img</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">example_file</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vol1</span> <span class="o">=</span> <span class="n">proxy_img</span><span class="o">.</span><span class="n">dataobj</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vol1</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(128, 96, 24)</span>
</pre></div>
</div>
<p>The slicing call in <code class="docutils literal"><span class="pre">proxy_img.dataobj[...,</span> <span class="pre">1]</span></code> will only load the data from
disk that you need to fill the memory of <code class="docutils literal"><span class="pre">vol1</span></code>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2006-2015, Matthew Brett, Michael Hanke and Eric Larson &lt;nipy-devel@neuroimaging.scipy.org&gt;.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.5.
    </div>
  </body>
</html>